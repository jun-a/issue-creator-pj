<!-- ローディングインジケーター -->
<div id="loading-indicator" class="has-text-centered py-6 is-hidden">
    <span class="icon is-large">
        <i class="fas fa-spinner fa-pulse fa-2x"></i>
    </span>
    <p class="mt-3">Issue を生成中...</p>
</div>

<div class="box" data-issue="{{ issue.json() | safe }}">
    <h3 class="title is-5">{{ issue.title }}</h3>
    
    <div class="tabs">
        <ul>
            <li class="is-active"><a data-tab="preview">プレビュー</a></li>
            <li><a data-tab="markdown">Markdown</a></li>
        </ul>
    </div>
    
    <div id="tab-preview" class="tab-content">
        <!-- ユーザーストーリー -->
        <div class="content">
            <h4 class="title is-6">User Story</h4>
            <p>{{ issue.story }}</p>
            
            <!-- 受け入れ基準 -->
            {% if issue.criteria %}
            <h4 class="title is-6">Acceptance Criteria</h4>
            <ul>
                {% for item in issue.criteria|format_list_items %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            
            <!-- 技術要件 -->
            {% if issue.requirements %}
            <h4 class="title is-6">Technical Requirements</h4>
            <ul>
                {% for item in issue.requirements|format_list_items %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>
    
    <div id="tab-markdown" class="tab-content is-hidden">
        <pre><code>{{ issue|to_markdown }}</code></pre>
    </div>
    
    <div class="field is-grouped mt-4">
        <div class="control">
            <a href="/preview/{{ issue.id }}" class="button is-info">
                <span class="icon mr-1">
                    <i class="fas fa-edit"></i>
                </span>
                <span>詳細表示</span>
            </a>
        </div>
        <div class="control">
            <button class="button is-primary" id="copy-markdown">
                <span class="icon mr-1">
                    <i class="fas fa-copy"></i>
                </span>
                <span>Markdownをコピー</span>
            </button>
        </div>
    </div>
</div>

{% if use_local_storage %}
<div data-auto-store="true" data-issue="{{ issue.json() | safe }}"></div>
{% endif %}
